#!/bin/sh

KCONFIG=build/config/Kconfig.remote

cat > $KCONFIG <<EOF
############################################
# This file is autogenerated, do not edit! #
############################################

choice REMOTE
  prompt "Remote"
  depends on PKG_lirc
EOF

for i in config/platforms/*; do
  arch=`basename $i`
  for j in config/platforms/$arch/*; do
    [ -d "$j" ] || continue
    platform=`basename $j`
    for k in config/platforms/$arch/$platform/machines/*; do
      machine=`basename $k`
      [ -r config/platforms/$arch/$platform/machines/$machine/meta ] || continue
      unset MACHINE_REMOTE
      . config/platforms/$arch/$platform/machines/$machine/meta
      [ -n "$MACHINE_REMOTE" ] && \
        echo "  default REMOTE_${MACHINE_REMOTE} if TARGET_MACHINE_${arch}_${platform}_${machine}" >> $KCONFIG
    done
  done
done

cat >> $KCONFIG <<EOF
  default REMOTE_atiusb

EOF

remotes=`ls packages/lirc*/config/lircd* | grep ^\.*.conf$ | sed 's:^.*lircd_\(.*\)\.conf$:\1:g' | sort`

for remote in $remotes; do
  cat >> $KCONFIG <<EOF
config REMOTE_${remote}
  bool "${remote}"
EOF
done

cat >> $KCONFIG <<EOF

endchoice

choice RECEIVER
  prompt "Receiver"
  depends on PKG_lirc
EOF

for i in config/platforms/*; do
  arch=`basename $i`
  for j in config/platforms/$arch/*; do
    [ -d "$j" ] || continue
    platform=`basename $j`
    for k in config/platforms/$arch/$platform/machines/*; do
      machine=`basename $k`
      [ -r config/platforms/$arch/$platform/machines/$machine/meta ] || continue
      unset MACHINE_RECEIVER
      . config/platforms/$arch/$platform/machines/$machine/meta
      [ -n "$MACHINE_RECEIVER" ] && \
        echo "  default RECEIVER_${MACHINE_RECEIVER} if TARGET_MACHINE_${arch}_${platform}_${machine}" >> $KCONFIG
    done
  done
done

cat >> $KCONFIG <<EOF
  default RECEIVER_atiusb

EOF

receivers=`ls packages/lirc*/config/lircd* | grep -v ^\.*.conf$ | sed 's:^.*lircd_\(.*\)$:\1:g' | sort`

for receiver in $receivers; do
  cat >> $KCONFIG <<EOF
config RECEIVER_${receiver}
  bool "${receiver}"
EOF
done

cat >> $KCONFIG <<EOF

endchoice

config OPT_REMOTE
  string
EOF

for remote in $remotes; do
  echo "  default \"${remote}\" if REMOTE_${remote}" >> $KCONFIG
done

cat >> $KCONFIG <<EOF

config OPT_RECEIVER
  string
EOF

for receiver in $receivers; do
  echo "  default \"${receiver}\" if RECEIVER_${receiver}" >> $KCONFIG
done
