#!/bin/sh

KCONFIG=build/config/Kconfig.flavours

cat > $KCONFIG <<EOF
############################################
# This file is autogenerated, do not edit! #
############################################

choice FLAVOUR
  prompt "Flavour"
  default FLAVOUR_geexbox

EOF

flavours=`ls -d config/flavours/* | sed s:config/flavours/:: | xargs`

for flavour in $flavours; do
  . config/flavours/$flavour/meta
  cat >> $KCONFIG <<EOF
config FLAVOUR_${FLAVOUR_NAME}
  bool "${FLAVOUR_SHORTDESC}"
EOF
  [ "$FLAVOUR_DEPENDS" = all ] && \
    FLAVOUR_DEPENDS="`ls -d packages/* | sed s:packages/::`"
  for pkg in $FLAVOUR_DEPENDS; do
    echo "  select PKG_${pkg}" >> $KCONFIG
  done
  cat >> $KCONFIG <<EOF
  help
`echo "$FLAVOUR_LONGDESC" | fmt | sed 's/^/    /g'`
EOF
  echo >> $KCONFIG
  [ -n "$FLAVOUR_KCONFIG" ] && \
    echo "$FLAVOUR_KCONFIG" >> $KCONFIG
done

cat >> $KCONFIG <<EOF
endchoice

config GX_FLAVOUR
  string
EOF

for flavour in $flavours; do
  echo "  default "$flavour" if FLAVOUR_${flavour}" >> $KCONFIG
done
