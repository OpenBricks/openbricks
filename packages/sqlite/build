#!/bin/sh

. config/options

$SCRIPTS/build toolchain

export config_BUILD_CC="$HOST_CC"
export config_BUILD_CFLAGS="$HOST_CFLAGS"
export config_BUILD_LIBS="$HOST_LDFLAGS"
export config_TARGET_CC="$CC"
export config_TARGET_LINK="$LD"
export config_TARGET_CFLAGS="$CFLAGS"
export config_TARGET_LFLAGS="$LDFLAGS -ldl"

if [ "$DEBUG" = yes ]; then
  DEBUG_CONFIG="--enable-debug"
else
  DEBUG_CONFIG="--disable-debug"
fi

export CFLAGS="$CFLAGS -fno-fast-math"

cd $BUILD/$1*
./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=$LIB_PREFIX \
            --enable-static \
            --disable-shared \
            --disable-tcl \
            --disable-readline \
            --enable-threadsafe \
            --enable-load-extension \
            $DEBUG_CONFIG \

make
make install
