diff -Naur syslinux-3.51.orig/mtools/syslinux.c syslinux-3.51/mtools/syslinux.c
--- syslinux-3.51.orig/mtools/syslinux.c	2007-07-15 18:17:45.000000000 +0200
+++ syslinux-3.51/mtools/syslinux.c	2007-07-15 18:23:42.000000000 +0200
@@ -127,12 +127,8 @@
   static unsigned char sectbuf[512];
   int dev_fd;
   struct stat st;
-  int status;
   char **argp, *opt;
-  char mtools_conf[] = "/tmp/syslinux-mtools-XXXXXX";
   const char *subdir = NULL;
-  int mtc_fd;
-  FILE *mtc, *mtp;
   struct libfat_filesystem *fs;
   libfat_sector_t s, *secp, sectors[65]; /* 65 is maximum possible */
   int32_t ldlinux_cluster;
@@ -207,44 +203,6 @@
   }
 
   /*
-   * Create an mtools configuration file
-   */
-  mtc_fd = mkstemp(mtools_conf);
-  if ( mtc_fd < 0 || !(mtc = fdopen(mtc_fd, "w")) ) {
-    perror(program);
-    exit(1);
-  }
-  fprintf(mtc,
-	  /* "MTOOLS_NO_VFAT=1\n" */
-	  "MTOOLS_SKIP_CHECK=1\n" /* Needed for some flash memories */
-	  "drive s:\n"
-	  "  file=\"/proc/%lu/fd/%d\"\n"
-	  "  offset=%llu\n",
-	  (unsigned long)mypid,
-	  dev_fd,
-	  (unsigned long long)filesystem_offset);
-  fclose(mtc);
-
-  /*
-   * Run mtools to create the LDLINUX.SYS file
-   */
-  if ( setenv("MTOOLSRC", mtools_conf, 1) ) {
-    perror(program);
-    exit(1);
-  }
-
-  /* This command may fail legitimately */
-  system("mattrib -h -r -s s:/ldlinux.sys 2>/dev/null");
-
-  mtp = popen("mcopy -D o -D O -o - s:/ldlinux.sys", "w");
-  if ( !mtp ||
-       (fwrite(syslinux_ldlinux, 1, syslinux_ldlinux_len, mtp)
-	!= syslinux_ldlinux_len) ||
-       (status = pclose(mtp), !WIFEXITED(status) || WEXITSTATUS(status)) ) {
-    die("failed to create ldlinux.sys");
-  }
-
-  /*
    * Now, use libfat to create a block map
    */
   fs = libfat_open(libfat_xpread, dev_fd);
@@ -266,70 +224,6 @@
   xpwrite(dev_fd, syslinux_ldlinux, 512,
 	  filesystem_offset + ((off_t)sectors[0] << 9));
 
-  /* Move ldlinux.sys to the desired location */
-  if (subdir) {
-    char target_file[4096], command[5120];
-    char *cp = target_file, *ep = target_file+sizeof target_file-16;
-    const char *sd;
-    int slash = 1;
-
-    cp += sprintf(cp, "'s:/");
-    for (sd = subdir; *sd; sd++) {
-      if (*sd == '/' || *sd == '\\') {
-	if (slash)
-	  continue;		/* Remove duplicated slashes */
-	slash = 1;
-      } else if (*sd == '\'' || *sd == '!') {
-	slash = 0;
-	if (cp < ep) *cp++ = '\'';
-	if (cp < ep) *cp++ = '\\';
-	if (cp < ep) *cp++ = *sd;
-	if (cp < ep) *cp++ = '\'';
-	continue;
-      } else {
-	slash = 0;
-      }
-
-      if (cp < ep)
-	*cp++ = *sd;
-    }
-    if (!slash)
-      *cp++ = '/';
-    strcpy(cp, "ldlinux.sys'");
-
-    /* This command may fail legitimately */
-    sprintf(command, "mattrib -h -r -s %s 2>/dev/null", target_file);
-    system(command);
-
-    sprintf(command, "mmove -D o -D O s:/ldlinux.sys %s", target_file);
-    status = system(command);
-
-    if ( !WIFEXITED(status) || WEXITSTATUS(status) ) {
-      fprintf(stderr,
-	      "%s: warning: unable to move ldlinux.sys\n",
-	    program);
-
-      status = system("mattrib +r +h +s s:/ldlinux.sys");
-    } else {
-      sprintf(command, "mattrib +r +h +s %s", target_file);
-      status = system(command);
-    }
-  } else {
-    status = system("mattrib +r +h +s s:/ldlinux.sys");
-  }
-
-  if ( !WIFEXITED(status) || WEXITSTATUS(status) ) {
-    fprintf(stderr,
-	    "%s: warning: failed to set system bit on ldlinux.sys\n",
-	    program);
-  }
-
-
-  /*
-   * Cleanup
-   */
-  unlink(mtools_conf);
-
   /*
    * To finish up, write the boot sector
    */
