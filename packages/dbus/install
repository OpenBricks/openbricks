#!/bin/sh

. config/options

cd $BUILD/$1*/objdir-target

do_install usr/bin/dbus-daemon
do_install usr/bin/dbus-uuidgen
do_install usr/bin/dbus-launch
if pkg_uses $1 devtools; then
  do_install usr/bin/dbus-monitor
  do_install usr/bin/dbus-send
fi

do_install usr/lib/libdbus-1.so*
do_install lib/systemd

mkdir -p $INSTALL/var/lib/dbus
mkdir -p $INSTALL/var/run/dbus
mkdir -p $INSTALL/usr/share/dbus-1/services
mkdir -p $INSTALL/usr/share/dbus-1/system-services

mkdir -p $INSTALL/usr/lib/dbus-1.0
cp bus/dbus-daemon-launch-helper $INSTALL/usr/lib/dbus-1.0

mkdir -p $INSTALL/etc/dbus-1/event.d
mkdir -p $INSTALL/etc/dbus-1/system.d
mkdir -p $INSTALL/etc/dbus-1/session.d

cp bus/session.conf $INSTALL/etc/dbus-1
sed 's%<servicehelper>.*</servicehelper>%<servicehelper>/usr/lib/dbus-1.0/dbus-daemon-launch-helper</servicehelper>%' bus/system.conf > $INSTALL/etc/dbus-1/system.conf
