#!/bin/sh

. config/options

[ "$XORG" = yes ] && CFG_X11="--enable-x11" || CFG_X11="--disable-x11"
[ "$TARGET_ARCH" = arm ] && CFG_GFX_DRV="gl,omap" || CFG_GFX_DRV="all"

CFG_INPUT_DRV="keyboard,linuxinput"
[ "$LIRC" = yes ] && CFG_INPUT_DRV="$CFG_INPUT_DRV,lirc"
[ "$TOUCHSCREEN" = yes ] && CFG_INPUT_DRV="$CFG_INPUT_DRV,tslib"

if [ "$DEBUG" = yes ]; then
  CFG_DEBUG="--enable-debug --enable-debug-support"
else
  CFG_DEBUG="--disable-debug --disable-debug-support"
fi

cd $BUILD/$1*
do_configure \
            --enable-largefile \
            --disable-osx \
            $CFG_X11 \
            $CFG_DEBUG \
            --enable-text \
            --enable-gettid \
            --enable-network \
            --enable-devmem \
            --enable-fbdev \
            --disable-sdl \
            --disable-vnc \
            --enable-sysfs \
            --enable-jpeg \
            --enable-zlib \
            --disable-png \
            --enable-gif \
            --enable-freetype \
            --enable-video4linux2 \
            --with-gfxdrivers=$CFG_GFX_DRV \
            --with-inputdrivers=$CFG_INPUT_DRV \
            --with-smooth-scaling \
            --without-tests \
            --without-tools \

make
make_install
sed -i "s:\(['= ]\)/usr:\\1$LIB_PREFIX:g" .install/usr/bin/directfb-config
