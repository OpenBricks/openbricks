#!/bin/sh

. config/options

cd $BUILD/$1*

do_install usr/lib/dri

pkg_uses $1 egl && \
  do_install usr/lib/egl

for i in OSMesa GLU glut; do
  do_install usr/lib/lib$i.so*
done

do_install usr/lib/mesa
[ "$TARGET_ARCH" = i386 -o "$TARGET_ARCH" = x86_64 ] && \
  do_install usr/lib/xorg/modules/drivers

MESA_LIBS="GL"

if pkg_uses $1 egl && [ "$EGL_PROVIDER" = mesa ]; then
  MESA_LIBS="$MESA_LIBS EGL"
fi

if pkg_uses $1 opengles && [ "$GLES_PROVIDER" = mesa ]; then
  MESA_LIBS="$MESA_LIBS GLESv1_CM GLESv2"
fi

if pkg_uses $1 openvg && [ "$OVG_PROVIDER" = mesa ]; then
  MESA_LIBS="$MESA_LIBS OpenVG"
fi

for i in $MESA_LIBS; do
  ln -s /usr/lib/mesa/lib$i.so.1 $INSTALL/usr/lib/lib$i.so.1
  ln -s lib$i.so.1 $INSTALL/usr/lib/lib$i.so
done

exit 0
