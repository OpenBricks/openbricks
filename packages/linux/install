#!/bin/sh

. config/options

# image
mkdir -p $INSTALL/boot
case $TARGET_ARCH in
  arm)
    cp $BUILD/$1*/arch/$TARGET_ARCH/boot/uImage $INSTALL/boot/uImage
    [ -f $BUILD/$1*/boot.ini ] && cp $BUILD/$1*/boot.ini $INSTALL/boot/boot.ini
    ;;
  i386|x86_64)
    cp $BUILD/$1*/arch/$TARGET_ARCH/boot/bzImage $INSTALL/boot/vmlinuz
    ;;
  mips|powerpc)
    cp $BUILD/$1*/vmlinux $INSTALL/boot/vmlinux
    $STRIP $INSTALL/boot/vmlinux
    ;;
  powerpc64)
    cp $BUILD/$1*/arch/powerpc/boot/zImage $INSTALL/boot/zImage
    $STRIP $INSTALL/boot/zImage
    ;;
esac

# copy kernel drivers
mkdir -p $INSTALL/lib/modules/$(kernel_version)
cp -r $BUILD/$1*/modules/* $INSTALL

# copy kernel firmwares (if present)
rm -rf $INSTALL/lib/firmware
mkdir -p $INSTALL/firmware
if [ -d $BUILD/$1*/modules/lib/firmware ]; then
  cp -rf $BUILD/$1*/modules/lib/firmware/* $INSTALL/firmware
else
  echo "No firmware"
fi

# config
mkdir -p $INSTALL/sbin
cp $PACKAGES/$1/scripts/setup_tvcard_options $INSTALL/sbin

mkdir -p $INSTALL/etc
cp $PACKAGES/$1/config/modules $INSTALL/etc
cp $PACKAGES/$1/config/tvcard $INSTALL/etc
cp $PACKAGES/$1/config/pvr $INSTALL/etc

mkdir -p $INSTALL/etc/modprobe.d
cp $PACKAGES/$1/config/tv.conf $INSTALL/etc/modprobe.d
