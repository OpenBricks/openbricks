092_dss2-fix-smem-len.diff

From: Benjamin Zores <ben@q6600.(none)>


---
 drivers/video/omap2/omapfb/omapfb-main.c |    6 ++----
 1 files changed, 2 insertions(+), 4 deletions(-)

diff --git a/drivers/video/omap2/omapfb/omapfb-main.c b/drivers/video/omap2/omapfb/omapfb-main.c
index 4b4506d..9934a92 100644
--- a/drivers/video/omap2/omapfb/omapfb-main.c
+++ b/drivers/video/omap2/omapfb/omapfb-main.c
@@ -559,7 +559,7 @@ static int setup_vrfb_rotation(struct fb_info *fbi)
 
 	/* used by open/write in fbmem.c */
 	fbi->screen_base = ofbi->region.vrfb.vaddr[0];
-
+	fix->smem_len = rg->size;
 	fix->smem_start = ofbi->region.vrfb.paddr[0];
 
 	switch (var->nonstd) {
@@ -574,8 +574,6 @@ static int setup_vrfb_rotation(struct fb_info *fbi)
 		break;
 	}
 
-	fix->smem_len = var->yres_virtual * fix->line_length;
-
 	return 0;
 }
 
@@ -620,7 +618,7 @@ void set_fb_fix(struct fb_info *fbi)
 			break;
 		}
 
-		fix->smem_len = var->yres_virtual * fix->line_length;
+		fix->smem_len = rg->size;
 	} else {
 		fix->line_length =
 			(var->xres_virtual * var->bits_per_pixel) >> 3;
