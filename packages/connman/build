#!/bin/sh

. config/options

cd $BUILD/$1*

if pkg_uses $1 wifi; then
  WIFI_CONFIG="--enable-wifi"
else
  WIFI_CONFIG="--disable-wifi"
fi

if pkg_uses $1 bluetooth; then
  BLUETOOTH_CONFIG="--enable-bluetooth"
else
  BLUETOOTH_CONFIG="--disable-bluetooth"
fi

do_configure \
            --enable-ethernet \
            $WIFI_CONFIG \
            $BLUETOOTH_CONFIG \
            --disable-hh2serial-gps \
            --disable-ofono \
            --disable-openconnect \
            --disable-portal \
            --enable-loopback \
            --enable-dnsproxy \
            --disable-google \
            --enable-meego \
            --disable-iwmx \
            --disable-iospm \
            --enable-ntpd \
            --with-ntpd=/usr/sbin/ntpd \
            --disable-polkit \
            --enable-client \
            --enable-test \
            --disable-tools \
            --enable-datafiles \
            --enable-systemd \

make
make_install

mkdir -p .install/usr/bin 
cp -P client/cm .install/usr/bin
cp -P test/* .install/usr/bin

mkdir -p .install/etc/systemd/system/multi-user.target.wants
ln -s /lib/systemd/system/connman.service .install/etc/systemd/system/multi-user.target.wants

exit 0
