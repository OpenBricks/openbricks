From e36bb2a3a17811f0e904a34a41489db551a36c84 Mon Sep 17 00:00:00 2001
From: Thomas Genty <tomlohave@geexbox.org>
Date: Fri, 10 Nov 2017 15:23:21 +0100
Subject: [PATCH] Revert "iconv is a required dependency"

This reverts commit cadd14550d014d22022d46676e84ad32562f2f64.
---
 CMakeLists.txt                                     |  1 -
 cmake/modules/{FindIconv.cmake => FindIConv.cmake} | 16 ++++------------
 cmake/platform/windowsstore/windowsstore.cmake     |  2 +-
 3 files changed, 5 insertions(+), 14 deletions(-)
 rename cmake/modules/{FindIconv.cmake => FindIConv.cmake} (64%)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 41936a5d15..77af3b1986 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -112,7 +112,6 @@ set(required_deps Cdio
                   Fmt
                   FreeType
                   FriBidi
-                  Iconv
                   LibDvd
                   Lzo2
                   PCRE
diff --git a/cmake/modules/FindIconv.cmake b/cmake/modules/FindIConv.cmake
similarity index 64%
rename from cmake/modules/FindIconv.cmake
rename to cmake/modules/FindIConv.cmake
index 8ee01fb6b8..a2428b80f1 100644
--- a/cmake/modules/FindIconv.cmake
+++ b/cmake/modules/FindIConv.cmake
@@ -15,19 +15,11 @@
 
 find_path(ICONV_INCLUDE_DIR NAMES iconv.h)
 
-find_library(ICONV_LIBRARY NAMES iconv libiconv c)
-
-set(CMAKE_REQUIRED_LIBRARIES ${ICONV_LIBRARY})
-check_function_exists(iconv HAVE_ICONV_FUNCTION)
-if(NOT HAVE_ICONV_FUNCTION)
-  check_function_exists(libiconv HAVE_LIBICONV_FUNCTION2)
-  set(HAVE_ICONV_FUNCTION ${HAVE_LIBICONV_FUNCTION2})
-  unset(HAVE_LIBICONV_FUNCTION2)
-endif()
+find_library(ICONV_LIBRARY NAMES iconv libiconv)
 
 include(FindPackageHandleStandardArgs)
-find_package_handle_standard_args(Iconv
-                                  REQUIRED_VARS ICONV_LIBRARY ICONV_INCLUDE_DIR HAVE_ICONV_FUNCTION)
+find_package_handle_standard_args(iconv
+                                  REQUIRED_VARS ICONV_LIBRARY ICONV_INCLUDE_DIR)
 
 if(ICONV_FOUND)
   set(ICONV_LIBRARIES ${ICONV_LIBRARY})
@@ -41,4 +33,4 @@ if(ICONV_FOUND)
   endif()
 endif()
 
-mark_as_advanced(ICONV_INCLUDE_DIR ICONV_LIBRARY HAVE_ICONV_FUNCTION)
+mark_as_advanced(ICONV_INCLUDE_DIR ICONV_LIBRARY)
diff --git a/cmake/platform/windowsstore/windowsstore.cmake b/cmake/platform/windowsstore/windowsstore.cmake
index 266fb3ee0e..b8de319f13 100644
--- a/cmake/platform/windowsstore/windowsstore.cmake
+++ b/cmake/platform/windowsstore/windowsstore.cmake
@@ -1 +1 @@
-set(PLATFORM_REQUIRED_DEPS zlib)
+set(PLATFORM_REQUIRED_DEPS zlib iconv)
\ No newline at end of file
-- 
2.11.0

