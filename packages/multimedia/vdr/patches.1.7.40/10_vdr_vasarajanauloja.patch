diff -urN vdr-1.7.40.orig/cutter.c vdr-1.7.40/cutter.c
--- vdr-1.7.40.orig/cutter.c	2013-02-17 15:11:03.000000000 +0100
+++ vdr-1.7.40/cutter.c	2013-03-10 20:59:56.372164321 +0100
@@ -8,6 +8,7 @@
  */
 
 #include "cutter.h"
+#include "interface.h"
 #include "menu.h"
 #include "recording.h"
 #include "remux.h"
@@ -632,7 +633,7 @@
 bool cCutter::error = false;
 bool cCutter::ended = false;
 
-bool cCutter::Start(const char *FileName)
+bool cCutter::Start(const char *FileName, const char *TargetFileName, bool Overwrite)
 {
   cMutexLock MutexLock(&mutex);
   if (!cuttingThread) {
@@ -646,11 +647,16 @@
      if (cMark *First = FromMarks.GetNextBegin())
         Recording.SetStartTime(Recording.Start() + (int(First->Position() / Recording.FramesPerSecond() + 30) / 60) * 60);
 
-     const char *evn = Recording.PrefixFileName('%');
-     if (evn && RemoveVideoFile(evn) && MakeDirs(evn, true)) {
+     cString evn = (TargetFileName && *TargetFileName) ? Recording.UpdateFileName(TargetFileName) : Recording.PrefixFileName('%');
+     if (!Overwrite && *evn && (access(*evn, F_OK) == 0) && !Interface->Confirm(tr("File already exists - overwrite?"))) {
+        do {
+           evn = PrefixVideoFileName(*evn, '%');
+        } while (*evn && (access(*evn, F_OK) == 0));
+        }
+     if (*evn && RemoveVideoFile(*evn) && MakeDirs(*evn, true)) {
         // XXX this can be removed once RenameVideoFile() follows symlinks (see videodir.c)
         // remove a possible deleted recording with the same name to avoid symlink mixups:
-        char *s = strdup(evn);
+        char *s = strdup(*evn);
         char *e = strrchr(s, '.');
         if (e) {
            if (strcmp(e, ".rec") == 0) {
diff -urN vdr-1.7.40.orig/cutter.h vdr-1.7.40/cutter.h
--- vdr-1.7.40.orig/cutter.h	2012-02-16 13:05:33.000000000 +0100
+++ vdr-1.7.40/cutter.h	2013-03-10 20:59:56.376164321 +0100
@@ -24,7 +24,7 @@
   static bool error;
   static bool ended;
 public:
-  static bool Start(const char *FileName);
+  static bool Start(const char *FileName, const char *TargetFileName = NULL, bool Overwrite = true);
   static void Stop(void);
   static bool Active(const char *FileName = NULL);
          ///< Returns true if the cutter is currently active.
diff -urN vdr-1.7.40.orig/dvbplayer.c vdr-1.7.40/dvbplayer.c
--- vdr-1.7.40.orig/dvbplayer.c	2013-03-08 14:44:19.000000000 +0100
+++ vdr-1.7.40/dvbplayer.c	2013-03-10 20:59:56.376164321 +0100
@@ -374,11 +374,16 @@
   if (index) {
      int Index = ptsIndex.FindIndex(DeviceGetSTC());
      if (Index >= 0) {
-        Index -= int(round(RESUMEBACKUP * framesPerSecond));
-        if (Index > 0)
-           Index = index->GetNextIFrame(Index, false);
-        else
+        int backup = int(round(RESUMEBACKUP * framesPerSecond));
+        if (Index >= index->Last() - backup)
            Index = 0;
+        else {
+           Index -= backup;
+           if (Index > 0)
+              Index = index->GetNextIFrame(Index, false);
+           else
+              Index = 0;
+           }
         if (Index >= 0)
            return index->StoreResume(Index);
         }
diff -urN vdr-1.7.40.orig/filetransfer.c vdr-1.7.40/filetransfer.c
--- vdr-1.7.40.orig/filetransfer.c	1970-01-01 01:00:00.000000000 +0100
+++ vdr-1.7.40/filetransfer.c	2013-03-10 20:59:56.376164321 +0100
@@ -0,0 +1,278 @@
+/*
+ * filetransfer.c: The video file transfer facilities
+ *
+ * See the main source file 'vdr.c' for copyright information and
+ * how to reach the author.
+ *
+ * $Id: $
+ */
+
+#include "videodir.h"
+#include "filetransfer.h"
+
+static cString StripLastDirectory(const char *DirName)
+{
+  if (DirName && *DirName) {
+     cString s(DirName);
+     int l = strlen(*s);
+     const char *p = *s + l;
+     while (l > 0) {
+           if (*p-- == '/')
+              break;
+           l--;
+           }
+     if (l)
+        s = s.Truncate(l);
+     return s;
+     }
+  return NULL;
+}
+
+// --- cCopyingThread --------------------------------------------------------
+
+class cCopyingThread : public cThread {
+private:
+  const char *error;
+  bool deleteSource;
+  cString source;
+  cString target;
+protected:
+  virtual void Action(void);
+public:
+  cCopyingThread(const char *SourceName, const char *ToFileName, bool DeleteSource = false);
+  virtual ~cCopyingThread();
+  const char *Error(void) { return error; }
+  };
+
+cCopyingThread::cCopyingThread(const char *SourceName, const char *TargetName, bool DeleteSource)
+:cThread("copying"),
+ error(NULL),
+ deleteSource(DeleteSource),
+ source(SourceName),
+ target(TargetName)
+{
+  // add missing directory delimiters
+  const char *delim = "/";
+  if (!endswith(*source, delim))
+     source = cString::sprintf("%s%s", *source, delim);
+  if (!endswith(*target, delim))
+     target = cString::sprintf("%s%s", *target, delim);
+
+  Start();
+}
+
+cCopyingThread::~cCopyingThread()
+{
+  Cancel(3);
+}
+
+void cCopyingThread::Action(void)
+{
+  SetPriority(19);
+  SetIOPriority(7);
+
+  if (strcmp(*source, *target)) {
+     // validate target directory
+     if (strstr(*target, *source)) {
+        error = "invalid target";
+        return;
+        }
+
+     // recordings methods require the last directory delimiter to be stripped off
+     cString recname = target;
+     recname.Truncate(strlen(*recname) - 1);
+     Recordings.AddByName(*recname, false);
+
+     RemoveFileOrDir(*target);
+     if (!MakeDirs(*target, true)) {
+        error = "MakeDirs";
+        return;
+        }
+
+     if (deleteSource && EntriesOnSameFileSystem(*source, *target)) {
+        if (rename(*source, *target) == -1) {
+           error = "rename";
+           return;
+           }
+        // delete all empty source directories
+        recname = source;
+        recname.Truncate(strlen(*recname) - 1);
+        recname = StripLastDirectory(*recname);
+        do {
+           if (!RemoveEmptyDirectories(*recname, true))
+              break;
+           recname = StripLastDirectory(*recname);
+           }
+        while (strcmp(*recname, VideoDirectory));
+        }
+     else {
+        int required = DirSizeMB(*source);
+        int available = FreeDiskSpaceMB(*target);
+
+        // validate free space
+        if (required < available) {
+           cReadDir d(*source);
+           struct dirent *e;
+           bool success = true;
+
+           // allocate copying buffer
+           const int len = 1024 * 1024;
+           char *buffer = MALLOC(char, len);
+           if (!buffer) {
+              error = "MALLOC";
+              return;
+              }
+
+           // loop through all files, but skip all sub-directories
+           while (Running() && (e = d.Next()) != NULL) {
+                 // skip generic entries
+                 if (strcmp(e->d_name, ".") && strcmp(e->d_name, "..") && strcmp(e->d_name, "lost+found")) {
+                    cString sourceFile = cString::sprintf("%s%s", *source, e->d_name);
+                    cString targetFile = cString::sprintf("%s%s", *target, e->d_name);
+
+                    // copy only regular files
+                    struct stat sts;
+                    if (!stat(*sourceFile, &sts) && S_ISREG(sts.st_mode)) {
+                       int r = -1, w = -1;
+                       cUnbufferedFile *inputFile = cUnbufferedFile::Create(*sourceFile, O_RDONLY | O_LARGEFILE);
+                       cUnbufferedFile *outputFile = cUnbufferedFile::Create(*targetFile, O_RDWR | O_CREAT | O_LARGEFILE);
+
+                       // validate files
+                       if (!inputFile || !outputFile) {
+                          success = false;
+                          break;
+                          }
+
+                       // do actual copy
+                       do {
+                         r = inputFile->Read(buffer, len);
+                         if (r > 0)
+                            w = outputFile->Write(buffer, r);
+                         else
+                            w = 0;
+                       } while (Running() && r > 0 && w > 0);
+                       DELETENULL(inputFile);
+                       DELETENULL(outputFile);
+
+                       // validate result
+                       if (!Running() || r < 0 || w < 0) {
+                          success = false;
+                          break;
+                          }
+                       }
+                   }
+                }
+
+           // release allocated buffer
+           free(buffer);
+
+           // delete all created target files and directories
+           if (!success) {
+              target = StripLastDirectory(*target);
+              RemoveFileOrDir(*target, true);
+              target = StripLastDirectory(*target);
+              RemoveEmptyDirectories(*target, true);
+              error = "copy failed";
+              return;
+              }
+           }
+        else {
+           // delete all created empty target directories
+           recname = target;
+           recname.Truncate(strlen(*recname) - 1);
+           recname = StripLastDirectory(*recname);
+           do {
+              if (!RemoveEmptyDirectories(*recname, true))
+                 break;
+              recname = StripLastDirectory(*recname);
+              }
+           while (strcmp(*recname, VideoDirectory));
+           error = "insufficient free space";
+           return;
+           }
+        }
+
+     if (deleteSource) {
+        // Recordings' methods require the last directory delimiter to be stripped off
+        source.Truncate(strlen(*source) - 1);
+        cRecording *recording = Recordings.GetByName(*source);
+        if (recording->Delete())
+           Recordings.DelByName(*source, false);
+        }
+     else
+        Recordings.TouchUpdate();
+     }
+}
+
+// --- cFileTransfer ----------------------------------------------------------------
+
+cMutex cFileTransfer::mutex;
+char *cFileTransfer::copiedVersionName = NULL;
+cCopyingThread *cFileTransfer::copyingThread = NULL;
+bool cFileTransfer::error = false;
+bool cFileTransfer::ended = false;
+
+bool cFileTransfer::Start(cRecording *Recording, const char *FileName, bool CopyOnly)
+{
+  cMutexLock MutexLock(&mutex);
+  if (!copyingThread) {
+     cString NewName = NewVideoFileName(Recording->FileName(), FileName);
+     error = false;
+     ended = false;
+     if (strlen(*NewName)) {
+        copiedVersionName = strdup(*NewName);
+        copyingThread = new cCopyingThread(Recording->FileName(), copiedVersionName, !CopyOnly);
+        return true;
+        }
+     }
+  return false;
+}
+
+void cFileTransfer::Stop(void)
+{
+  cMutexLock MutexLock(&mutex);
+  bool Interrupted = copyingThread && copyingThread->Active();
+  const char *Error = copyingThread ? copyingThread->Error() : NULL;
+  DELETENULL(copyingThread);
+  if (Interrupted || Error) {
+     if (Interrupted)
+        isyslog("file transfer has been interrupted");
+     if (Error)
+        esyslog("ERROR: '%s' during file transfer", Error);
+     RemoveVideoFile(copiedVersionName); //XXX what if this file is currently being replayed?
+     Recordings.DelByName(copiedVersionName);
+     free(copiedVersionName);
+     copiedVersionName = NULL;
+     }
+}
+
+bool cFileTransfer::Active(void)
+{
+  cMutexLock MutexLock(&mutex);
+  if (copyingThread) {
+     if (copyingThread->Active())
+        return true;
+     error = copyingThread->Error();
+     Stop();
+     free(copiedVersionName);
+     copiedVersionName = NULL;
+     ended = true;
+     }
+  return false;
+}
+
+bool cFileTransfer::Error(void)
+{
+  cMutexLock MutexLock(&mutex);
+  bool result = error;
+  error = false;
+  return result;
+}
+
+bool cFileTransfer::Ended(void)
+{
+  cMutexLock MutexLock(&mutex);
+  bool result = ended;
+  ended = false;
+  return result;
+}
diff -urN vdr-1.7.40.orig/filetransfer.h vdr-1.7.40/filetransfer.h
--- vdr-1.7.40.orig/filetransfer.h	1970-01-01 01:00:00.000000000 +0100
+++ vdr-1.7.40/filetransfer.h	2013-03-10 20:59:56.376164321 +0100
@@ -0,0 +1,33 @@
+/*
+ * filetransfer.h: The video file transfer facilities
+ *
+ * See the main source file 'vdr.c' for copyright information and
+ * how to reach the author.
+ *
+ * $Id: $
+ */
+
+#ifndef __FILETRANSFER_H
+#define __FILETRANSFER_H
+
+#include "recording.h"
+#include "thread.h"
+
+class cCopyingThread;
+
+class cFileTransfer {
+private:
+  static cMutex mutex;
+  static char *copiedVersionName;
+  static cCopyingThread *copyingThread;
+  static bool error;
+  static bool ended;
+public:
+  static bool Start(cRecording *Recording, const char *NewName, bool CopyOnly = false);
+  static void Stop(void);
+  static bool Active(void);
+  static bool Error(void);
+  static bool Ended(void);
+  };
+
+#endif //__FILETRANSFER_H
diff -urN vdr-1.7.40.orig/Makefile vdr-1.7.40/Makefile
--- vdr-1.7.40.orig/Makefile	2013-02-24 11:40:23.000000000 +0100
+++ vdr-1.7.40/Makefile	2013-03-10 20:59:56.376164321 +0100
@@ -67,7 +67,7 @@
 SILIB    = $(LSIDIR)/libsi.a
 
 OBJS = audio.o channels.o ci.o config.o cutter.o device.o diseqc.o dvbdevice.o dvbci.o\
-       dvbplayer.o dvbspu.o dvbsubtitle.o eit.o eitscan.o epg.o filter.o font.o i18n.o interface.o keys.o\
+       dvbplayer.o dvbspu.o dvbsubtitle.o eit.o eitscan.o epg.o filetransfer.o filter.o font.o i18n.o interface.o keys.o\
        lirc.o menu.o menuitems.o nit.o osdbase.o osd.o pat.o player.o plugin.o\
        receiver.o recorder.o recording.o remote.o remux.o ringbuffer.o sdt.o sections.o shutdown.o\
        skinclassic.o skinlcars.o skins.o skinsttng.o sourceparams.o sources.o spu.o status.o svdrp.o themes.o thread.o\
diff -urN vdr-1.7.40.orig/MANUAL vdr-1.7.40/MANUAL
--- vdr-1.7.40.orig/MANUAL	2013-03-04 14:45:33.000000000 +0100
+++ vdr-1.7.40/MANUAL	2013-03-10 20:59:56.380164320 +0100
@@ -48,7 +48,7 @@
   FastRew     fast rewind
 
   Next        Next/previous channel group (in live tv mode)
-  Prev        or next/previous editing mark (in replay mode)
+  Prev        or binary skipping (in replay mode)
 
   Channel+    channel up
   Channel-    channel down
diff -urN vdr-1.7.40.orig/menu.c vdr-1.7.40/menu.c
--- vdr-1.7.40.orig/menu.c	2013-03-04 15:11:47.000000000 +0100
+++ vdr-1.7.40/menu.c	2013-03-10 20:59:56.384164320 +0100
@@ -18,6 +18,7 @@
 #include "config.h"
 #include "cutter.h"
 #include "eitscan.h"
+#include "filetransfer.h"
 #include "i18n.h"
 #include "interface.h"
 #include "plugin.h"
@@ -2218,6 +2219,167 @@
      DisplayMenu->SetItem(Text(), Index, Current, Selectable);
 }
 
+// --- cMenuEditRecording ----------------------------------------------------
+
+class cMenuEditRecording : public cOsdMenu {
+private:
+  char name[MaxFileName];
+  cMenuEditStrItem *file;
+  cOsdItem *marksItem, *resumeItem;
+  bool isResume, isMarks;
+  cRecording *recording;
+  void SetHelpKeys(void);
+  eOSState SetFolder(void);
+public:
+  cMenuEditRecording(cRecording *Recording);
+  virtual eOSState ProcessKey(eKeys Key);
+};
+
+cMenuEditRecording::cMenuEditRecording(cRecording *Recording)
+:cOsdMenu(tr("Edit recording"), 14)
+{
+  cMarks marks;
+
+  file = NULL;
+  recording = Recording;
+
+  if (recording) {
+     Utf8Strn0Cpy(name, recording->Name(), sizeof(name));
+     Add(file = new cMenuEditStrItem(tr("File"), name, sizeof(name)));
+
+     Add(new cOsdItem("", osUnknown, false));
+
+     Add(new cOsdItem(cString::sprintf("%s:\t%s", tr("Date"), *DayDateTime(recording->Start())), osUnknown, false));
+
+     cChannel *channel = Channels.GetByChannelID(((cRecordingInfo *)recording->Info())->ChannelID());
+     if (channel)
+        Add(new cOsdItem(cString::sprintf("%s:\t%s", tr("Channel"), *ChannelString(channel, 0)), osUnknown, false));
+
+     int recLen = recording->LengthInSeconds();
+     if (recLen >= 0)
+        Add(new cOsdItem(cString::sprintf("%s:\t%d:%02d:%02d", tr("Length"), recLen / 3600, recLen / 60 % 60, recLen % 60), osUnknown, false));
+     else
+        recLen = 0;
+
+     int dirSize = DirSizeMB(recording->FileName());
+     cString bitRate = recLen ? cString::sprintf(" (%.2f MBit/s)", 8.0 * dirSize / recLen) : cString("");
+     Add(new cOsdItem(cString::sprintf("%s:\t%s", tr("Format"), recording->IsPesRecording() ? tr("PES") : tr("TS")), osUnknown, false));
+     Add(new cOsdItem((dirSize > 9999) ? cString::sprintf("%s:\t%.2f GB%s", tr("Size"), dirSize / 1024.0, *bitRate) : cString::sprintf("%s:\t%d MB%s", tr("Size"), dirSize, *bitRate), osUnknown, false));
+
+     Add(new cOsdItem("", osUnknown, false));
+
+     isMarks = marks.Load(recording->FileName(), recording->FramesPerSecond(), recording->IsPesRecording()) && marks.Count();
+     marksItem = new cOsdItem(tr("Delete marks information?"), osUser1, isMarks);
+     Add(marksItem);
+
+     cResumeFile ResumeFile(recording->FileName(), recording->IsPesRecording());
+     isResume = (ResumeFile.Read() != -1);
+     resumeItem = new cOsdItem(tr("Delete resume information?"), osUser2, isResume);
+     Add(resumeItem);
+     }
+
+  SetHelpKeys();
+}
+
+void cMenuEditRecording::SetHelpKeys(void)
+{
+  SetHelp(tr("Button$Folder"), tr("Button$Cut"), tr("Button$Copy"), tr("Button$Rename/Move"));
+}
+
+eOSState cMenuEditRecording::SetFolder(void)
+{
+  cMenuFolder *mf = (cMenuFolder *)SubMenu();
+  if (mf) {
+     cString Folder = mf->GetFolder();
+     char *p = strrchr(name, FOLDERDELIMCHAR);
+     if (p)
+        p++;
+     else
+        p = name;
+     if (!isempty(*Folder))
+        strn0cpy(name, cString::sprintf("%s%c%s", *Folder, FOLDERDELIMCHAR, p), sizeof(name));
+     else if (p != name)
+        memmove(name, p, strlen(p) + 1);
+     SetCurrent(file);
+     Display();
+     }
+  return CloseSubMenu();
+}
+
+eOSState cMenuEditRecording::ProcessKey(eKeys Key)
+{
+  eOSState state = cOsdMenu::ProcessKey(Key);
+
+  if (state == osUnknown) {
+     switch (Key) {
+       case kRed:
+            return AddSubMenu(new cMenuFolder(tr("Select folder"), &Folders, name));
+            break;
+       case kGreen:
+            if (!cCutter::Active()) {
+               if (!isMarks)
+                  Skins.Message(mtError, tr("No editing marks defined!"));
+               else if (!cCutter::Start(recording->FileName(), strcmp(recording->Name(), name) ? *NewVideoFileName(recording->FileName(), name) : NULL, false))
+                  Skins.Message(mtError, tr("Can't start editing process!"));
+               else
+                  Skins.Message(mtInfo, tr("Editing process started"));
+               }
+            else
+               Skins.Message(mtError, tr("Editing process already active!"));
+            return osContinue;
+       case kYellow:
+       case kBlue:
+            if (strcmp(recording->Name(), name)) {
+               if (!cFileTransfer::Active()) {
+                  if (cFileTransfer::Start(recording, name, (Key == kYellow)))
+                     Skins.Message(mtInfo, tr("File transfer started"));
+                  else
+                     Skins.Message(mtError, tr("Can't start file transfer!"));
+                  }
+               else
+                  Skins.Message(mtError, tr("File transfer already active!"));
+               }
+            return osRecordings;
+       default:
+            break;
+       }
+     return osContinue;
+     }
+  else if (state == osEnd && HasSubMenu())
+     state = SetFolder();
+  else if (state == osUser1) {
+     if (isMarks && Interface->Confirm(tr("Delete marks information?"))) {
+        cMarks marks;
+        marks.Load(recording->FileName(), recording->FramesPerSecond(), recording->IsPesRecording());
+        cMark *mark = marks.First();
+        while (mark) {
+              cMark *nextmark = marks.Next(mark);
+              marks.Del(mark);
+              mark = nextmark;
+              }
+        marks.Save();
+        isMarks = false;
+        marksItem->SetSelectable(isMarks);
+        SetCurrent(First());
+        Display();
+        }
+     return osContinue;
+     }
+  else if (state == osUser2) {
+     if (isResume && Interface->Confirm(tr("Delete resume information?"))) {
+        cResumeFile ResumeFile(recording->FileName(), recording->IsPesRecording());
+        ResumeFile.Delete();
+        isResume = false;
+        resumeItem->SetSelectable(isResume);
+        SetCurrent(First());
+        Display();
+        }
+     return osContinue;
+     }
+
+  return state;
+}
+
 // --- cMenuRecordings -------------------------------------------------------
 
 cMenuRecordings::cMenuRecordings(const char *Base, int Level, bool OpenSubMenus)
@@ -2460,6 +2622,16 @@
   return osContinue;
 }
 
+eOSState cMenuRecordings::Edit(void)
+{
+  if (HasSubMenu() || Count() == 0)
+     return osContinue;
+  cMenuRecordingItem *ri = (cMenuRecordingItem *)Get(Current());
+  if (ri && !ri->IsDirectory() && ri->Recording())
+     return AddSubMenu(new cMenuEditRecording(ri->Recording()));
+  return osContinue;
+}
+
 eOSState cMenuRecordings::ProcessKey(eKeys Key)
 {
   bool HadSubMenu = HasSubMenu();
@@ -2473,7 +2645,7 @@
        case kRed:    return (helpKeys > 1 && RecordingCommands.Count()) ? Commands() : Play();
        case kGreen:  return Rewind();
        case kYellow: return Delete();
-       case kInfo:
+       case kInfo:   return Edit();
        case kBlue:   return Info();
        case k0:      return Sort();
        case k1...k9: return Commands(Key);
@@ -3373,6 +3545,7 @@
   replaying = false;
   stopReplayItem = NULL;
   cancelEditingItem = NULL;
+  cancelFileTransferItem = NULL;
   stopRecordingItem = NULL;
   recordControlsState = 0;
   Set();
@@ -3467,6 +3640,19 @@
      result = true;
      }
 
+  // File transfer control:
+  bool FileTransferActive = cFileTransfer::Active();
+  if (FileTransferActive && !cancelFileTransferItem) {
+     // TRANSLATORS: note the leading blank!
+     Add(cancelFileTransferItem = new cOsdItem(tr(" Cancel file transfer"), osCancelTransfer));
+     result = true;
+     }
+  else if (cancelFileTransferItem && !FileTransferActive) {
+     Del(cancelFileTransferItem->Index());
+     cancelFileTransferItem = NULL;
+     result = true;
+     }
+
   // Record control:
   if (cRecordControls::StateChanged(recordControlsState)) {
      while (stopRecordingItem) {
@@ -3515,6 +3701,12 @@
                           return osEnd;
                           }
                        break;
+    case osCancelTransfer:
+                       if (Interface->Confirm(tr("Cancel file transfer?"))) {
+                          cFileTransfer::Stop();
+                          return osEnd;
+                          }
+                       break;
     case osPlugin:     {
                          cMenuPluginItem *item = (cMenuPluginItem *)Get(Current());
                          if (item) {
@@ -4488,6 +4680,10 @@
 
 // --- cReplayControl --------------------------------------------------------
 
+#define REPLAYCONTROLSKIPLIMIT   9    // s
+#define REPLAYCONTROLSKIPSECONDS 90   // s
+#define REPLAYCONTROLSKIPTIMEOUT 5000 // ms
+
 cReplayControl *cReplayControl::currentReplayControl = NULL;
 cString cReplayControl::fileName;
 
@@ -4502,6 +4698,9 @@
   lastCurrent = lastTotal = -1;
   lastPlay = lastForward = false;
   lastSpeed = -2; // an invalid value
+  lastSkipKey = kNone;
+  lastSkipSeconds = REPLAYCONTROLSKIPSECONDS;
+  lastSkipTimeout.Set(0);
   timeoutShow = 0;
   timeSearchActive = false;
   cRecording Recording(fileName);
@@ -4834,7 +5033,7 @@
            Skins.Message(mtError, tr("No editing marks defined!"));
         else if (!marks.GetNumSequences())
            Skins.Message(mtError, tr("No editing sequences defined!"));
-        else if (!cCutter::Start(fileName))
+        else if (!cCutter::Start(fileName, NULL, false))
            Skins.Message(mtError, tr("Can't start editing process!"));
         else
            Skins.Message(mtInfo, tr("Editing process started"));
@@ -4932,6 +5131,32 @@
     case kGreen:   SkipSeconds(-60); break;
     case kYellow|k_Repeat:
     case kYellow:  SkipSeconds( 60); break;
+    case k1|k_Repeat:
+    case k1:       SkipSeconds(-20); break;
+    case k3|k_Repeat:
+    case k3:       SkipSeconds( 20); break;
+    case kPrev|k_Repeat:
+    case kPrev:    if (lastSkipTimeout.TimedOut()) {
+                      lastSkipSeconds = REPLAYCONTROLSKIPSECONDS;
+                      lastSkipKey = kPrev;
+                   }
+                   else if (RAWKEY(lastSkipKey) != kPrev && lastSkipSeconds > (2 * REPLAYCONTROLSKIPLIMIT)) {
+                      lastSkipSeconds /= 2;
+                      lastSkipKey = kNone;
+                   }
+                   lastSkipTimeout.Set(REPLAYCONTROLSKIPTIMEOUT);
+                   SkipSeconds(-lastSkipSeconds); break;
+    case kNext|k_Repeat:
+    case kNext:    if (lastSkipTimeout.TimedOut()) {
+                      lastSkipSeconds = REPLAYCONTROLSKIPSECONDS;
+                      lastSkipKey = kNext;	
+                   }
+                   else if (RAWKEY(lastSkipKey) != kNext && lastSkipSeconds > (2 * REPLAYCONTROLSKIPLIMIT)) {
+                      lastSkipSeconds /= 2;
+                      lastSkipKey = kNone;
+                   }
+                   lastSkipTimeout.Set(REPLAYCONTROLSKIPTIMEOUT);
+                   SkipSeconds(lastSkipSeconds); break;
     case kStop:
     case kBlue:    Hide();
                    Stop();
@@ -4941,12 +5166,8 @@
       switch (int(Key)) {
         // Editing:
         case kMarkToggle:      MarkToggle(); break;
-        case kPrev|k_Repeat:
-        case kPrev:
         case kMarkJumpBack|k_Repeat:
         case kMarkJumpBack:    MarkJump(false); break;
-        case kNext|k_Repeat:
-        case kNext:
         case kMarkJumpForward|k_Repeat:
         case kMarkJumpForward: MarkJump(true); break;
         case kMarkMoveBack|k_Repeat:
diff -urN vdr-1.7.40.orig/menu.h vdr-1.7.40/menu.h
--- vdr-1.7.40.orig/menu.h	2012-12-07 14:44:13.000000000 +0100
+++ vdr-1.7.40/menu.h	2013-03-10 20:59:56.384164320 +0100
@@ -101,6 +101,7 @@
   bool replaying;
   cOsdItem *stopReplayItem;
   cOsdItem *cancelEditingItem;
+  cOsdItem *cancelFileTransferItem;
   cOsdItem *stopRecordingItem;
   int recordControlsState;
   static cOsdObject *pluginOsdObject;
@@ -206,6 +207,7 @@
   eOSState Info(void);
   eOSState Sort(void);
   eOSState Commands(eKeys Key = kNone);
+  eOSState Edit(void);
 protected:
   cString DirectoryName(void);
 public:
@@ -264,6 +266,9 @@
   int lastCurrent, lastTotal;
   bool lastPlay, lastForward;
   int lastSpeed;
+  int lastSkipSeconds;
+  eKeys lastSkipKey;
+  cTimeMs lastSkipTimeout;
   time_t timeoutShow;
   bool timeSearchActive, timeSearchHide;
   int timeSearchTime, timeSearchPos;
diff -urN vdr-1.7.40.orig/osdbase.c vdr-1.7.40/osdbase.c
--- vdr-1.7.40.orig/osdbase.c	2012-12-07 10:50:47.000000000 +0100
+++ vdr-1.7.40/osdbase.c	2013-03-10 20:59:56.384164320 +0100
@@ -82,6 +82,7 @@
 {
   isMenu = true;
   digit = 0;
+  key_nr = -1;
   hasHotkeys = false;
   displayMenuItems = 0;
   title = NULL;
@@ -131,7 +132,7 @@
         digit = -1; // prevents automatic hotkeys - input already has them
      if (digit >= 0) {
         digit++;
-        buffer = cString::sprintf(" %c %s", (digit < 10) ? '0' + digit : ' ' , s);
+        buffer = cString::sprintf(" %2d%s %s", digit, (digit > 9) ? "" : " ", s);
         s = buffer;
         }
      }
@@ -477,20 +478,60 @@
      }
 }
 
+#define MENUKEY_TIMEOUT 1500
+
 eOSState cOsdMenu::HotKey(eKeys Key)
 {
-  for (cOsdItem *item = First(); item; item = Next(item)) {
+  bool match = false;
+  bool highlight = false;
+  int  item_nr;
+  int  i;
+
+  if (Key == kNone) {
+     if (lastActivity.TimedOut())
+        Key = kOk;
+     else
+        return osContinue;
+     }
+  else
+     lastActivity.Set(MENUKEY_TIMEOUT);
+  for (cOsdItem *item = Last(); item; item = Prev(item)) {
       const char *s = item->Text();
-      if (s && (s = skipspace(s)) != NULL) {
-         if (*s == Key - k1 + '1') {
+      i = 0;
+      item_nr = 0;
+      if (s && (s = skipspace(s)) != '\0' && '0' <= s[i] && s[i] <= '9') {
+         do {
+            item_nr = item_nr * 10 + (s[i] - '0');
+            }
+         while ( !((s[++i] == '\t')||(s[i] == ' ')) && (s[i] != '\0') && ('0' <= s[i]) && (s[i] <= '9'));
+         if ((Key == kOk) && (item_nr == key_nr)) {
             current = item->Index();
             RefreshCurrent();
             Display();
             cRemote::Put(kOk, true);
+            key_nr = -1;
             break;
             }
+         else if (Key != kOk) {
+            if (!highlight && (item_nr == (Key - k0))) {
+               highlight = true;
+               current = item->Index();
+               }
+            if (!match && (key_nr == -1) && ((item_nr / 10) == (Key - k0))) {
+               match = true;
+               key_nr = (Key - k0);
+               }
+            else if (((key_nr == -1) && (item_nr == (Key - k0))) || (!match && (key_nr >= 0) && (item_nr == (10 * key_nr + Key - k0)))) {
+               current = item->Index();
+               cRemote::Put(kOk, true);
+               key_nr = -1;
+               break;
+               }
+            }
          }
       }
+  if ((!match) && (Key != kNone))
+     key_nr = -1;
   return osContinue;
 }
 
@@ -529,8 +570,8 @@
         }
      }
   switch (int(Key)) {
-    case k0:      return osUnknown;
-    case k1...k9: return hasHotkeys ? HotKey(Key) : osUnknown;
+    case kNone:
+    case k0...k9: return hasHotkeys ? HotKey(Key) : osUnknown;
     case kUp|k_Repeat:
     case kUp:   CursorUp();   break;
     case kDown|k_Repeat:
diff -urN vdr-1.7.40.orig/osdbase.h vdr-1.7.40/osdbase.h
--- vdr-1.7.40.orig/osdbase.h	2012-12-07 10:49:35.000000000 +0100
+++ vdr-1.7.40/osdbase.h	2013-03-10 20:59:56.384164320 +0100
@@ -30,6 +30,7 @@
                 osStopRecord,
                 osStopReplay,
                 osCancelEdit,
+                osCancelTransfer,
                 osSwitchDvb,
                 osBack,
                 osEnd,
@@ -98,6 +99,8 @@
   char *status;
   int digit;
   bool hasHotkeys;
+  int key_nr;
+  cTimeMs lastActivity;
   void DisplayHelp(bool Force = false);
 protected:
   void SetDisplayMenu(void);
diff -urN vdr-1.7.40.orig/po/de_DE.po vdr-1.7.40/po/de_DE.po
--- vdr-1.7.40.orig/po/de_DE.po	2013-03-07 10:51:06.000000000 +0100
+++ vdr-1.7.40/po/de_DE.po	2013-03-10 20:59:56.384164320 +0100
@@ -1398,3 +1398,70 @@
 
 msgid "free"
 msgstr "frei"
+
+msgid "Edit recording"
+msgstr "Aufnahme bearbeiten"
+
+msgid "Button$Cut"
+msgstr "Schneiden"
+
+msgid "Button$Copy"
+msgstr "Kopieren"
+
+msgid "Button$Rename/Move"
+msgstr "Umbenennen/Bewegen"
+
+msgid "Date"
+msgstr "Datum"
+
+msgid "Length"
+msgstr "Länge"
+
+msgid "Format"
+msgstr "Format"
+
+msgid "PES"
+msgstr "PES"
+
+msgid "TS"
+msgstr "TS"
+
+msgid "Size"
+msgstr "Größe"
+
+msgid "Delete marks information?"
+msgstr "Gespeicherte Schnittmarken löschen?"
+
+msgid "Delete resume information?"
+msgstr "Gespeicherten Zeitpunkt der letzten Wiedergabe löschen?"
+
+msgid "File transfer started"
+msgstr "Dateiübertragung gestartet"
+
+msgid "Can't start file transfer!"
+msgstr "Dateiübertragung kann nicht gestartet werden!"
+
+msgid "File transfer already active!"
+msgstr "Dateiübertragung bereits aktiv!"
+ 
+#. TRANSLATORS: note the leading blank!
+msgid " Cancel file transfer"
+msgstr " Dateiübertragung beenden"
+
+msgid "Cancel file transfer?"
+msgstr "Dateiübertragung beenden?"
+
+msgid "Transfering file - shut down anyway?"
+msgstr "Übertrage Datei - trotzdem ausschalten?"
+
+msgid "Transfering file - restart anyway?"
+msgstr "Übertrage Datei - trotzdem neustarten?"
+
+msgid "File transfer failed!"
+msgstr "Dateiübertragung fehlgeschlagen!"
+
+msgid "File transfer finished"
+msgstr "Dateiübertragung fertiggestellt"
+
+msgid "File already exists - overwrite?"
+msgstr "Datei besteht bereits - überschreiben?"
diff -urN vdr-1.7.40.orig/po/fi_FI.po vdr-1.7.40/po/fi_FI.po
--- vdr-1.7.40.orig/po/fi_FI.po	2013-03-07 10:51:05.000000000 +0100
+++ vdr-1.7.40/po/fi_FI.po	2013-03-10 20:59:56.384164320 +0100
@@ -1402,3 +1402,70 @@
 
 msgid "free"
 msgstr "vapaana"
+
+msgid "Edit recording"
+msgstr "Muokkaa tallennetta"
+
+msgid "Button$Cut"
+msgstr "Leikkaa"
+
+msgid "Button$Copy"
+msgstr "Kopioi"
+
+msgid "Button$Rename/Move"
+msgstr "NimeÃ¤/SiirrÃ¤"
+
+msgid "Date"
+msgstr "PÃ¤ivÃ¤ys"
+
+msgid "Length"
+msgstr "Pituus"
+
+msgid "Format"
+msgstr "Tiedostomuoto"
+
+msgid "PES"
+msgstr "PES"
+
+msgid "TS"
+msgstr "TS"
+
+msgid "Size"
+msgstr "Koko"
+
+msgid "Delete marks information?"
+msgstr "Poista tallenteen merkinnÃ¤t?"
+
+msgid "Delete resume information?"
+msgstr "Poista tallenteen paluutiedot?"
+
+msgid "File transfer started"
+msgstr "Tiedoston siirto aloitettu"
+
+msgid "Can't start file transfer!"
+msgstr "Tiedoston siirron aloitus epÃ¤onnistui!"
+
+msgid "File transfer already active!"
+msgstr "Tiedoston siirto on jo kÃ¤ynnissÃ¤!"
+ 
+#. TRANSLATORS: note the leading blank!
+msgid " Cancel file transfer"
+msgstr " Peru tiedoston siirto"
+
+msgid "Cancel file transfer?"
+msgstr "Perutaanko tiedoston siirto?"
+
+msgid "Transfering file - shut down anyway?"
+msgstr "Tiedoston siirto kesken - sammutetaanko?"
+
+msgid "Transfering file - restart anyway?"
+msgstr "Tiedoston siirto kesken - kÃ¤ynnistetÃ¤Ã¤nkÃ¶ uudelleen?"
+
+msgid "File transfer failed!"
+msgstr "Tiedoston siirto epÃ¤onnistui!"
+
+msgid "File transfer finished"
+msgstr "Tiedoston siirto valmis"
+
+msgid "File already exists - overwrite?"
+msgstr "Tiedosto on jo olemassa - ylikirjoitetaanko?"
diff -urN vdr-1.7.40.orig/recording.c vdr-1.7.40/recording.c
--- vdr-1.7.40.orig/recording.c	2013-03-04 15:02:40.000000000 +0100
+++ vdr-1.7.40/recording.c	2013-03-10 20:59:56.384164320 +0100
@@ -1066,6 +1066,16 @@
   return NULL;
 }
 
+const char *cRecording::UpdateFileName(const char *FileName)
+{
+  if (FileName && *FileName) {
+     free(fileName);
+     fileName = strdup(FileName);
+     return fileName;
+     }
+  return NULL;
+}
+
 int cRecording::HierarchyLevels(void) const
 {
   const char *s = name;
@@ -1358,7 +1368,7 @@
      }
 }
 
-void cRecordings::DelByName(const char *FileName)
+void cRecordings::DelByName(const char *FileName, bool RemoveRecording)
 {
   LOCK_THREAD;
   cRecording *recording = GetByName(FileName);
@@ -1366,7 +1376,7 @@
      cThreadLock DeletedRecordingsLock(&DeletedRecordings);
      Del(recording, false);
      char *ext = strrchr(recording->fileName, '.');
-     if (ext) {
+     if (ext && RemoveRecording) {
         strncpy(ext, DELEXT, strlen(ext));
         if (access(recording->FileName(), F_OK) == 0) {
            recording->deleted = time(NULL);
diff -urN vdr-1.7.40.orig/recording.h vdr-1.7.40/recording.h
--- vdr-1.7.40.orig/recording.h	2013-03-04 15:01:23.000000000 +0100
+++ vdr-1.7.40/recording.h	2013-03-10 20:59:56.384164320 +0100
@@ -119,6 +119,7 @@
   const char *Title(char Delimiter = ' ', bool NewIndicator = false, int Level = -1) const;
   const cRecordingInfo *Info(void) const { return info; }
   const char *PrefixFileName(char Prefix);
+  const char *UpdateFileName(const char *FileName);
   int HierarchyLevels(void) const;
   void ResetResume(void) const;
   double FramesPerSecond(void) const { return framesPerSecond; }
@@ -130,7 +131,7 @@
   int FileSizeMB(void) const;
        ///< Returns the total file size of this recording (in MB), or -1 if the file
        ///< size is unknown.
-  bool IsNew(void) const { return GetResume() <= 0; }
+  bool IsNew(void) const { return GetResume() < 0; }
   bool IsEdited(void) const;
   bool IsPesRecording(void) const { return isPesRecording; }
   bool IsOnVideoDirectoryFileSystem(void) const;
@@ -191,7 +192,7 @@
   void ClearSortNames(void);
   cRecording *GetByName(const char *FileName);
   void AddByName(const char *FileName, bool TriggerUpdate = true);
-  void DelByName(const char *FileName);
+  void DelByName(const char *FileName, bool RemoveRecording = true);
   void UpdateByName(const char *FileName);
   int TotalFileSizeMB(void);
   double MBperMinute(void);
diff -urN vdr-1.7.40.orig/shutdown.c vdr-1.7.40/shutdown.c
--- vdr-1.7.40.orig/shutdown.c	2013-02-18 11:33:26.000000000 +0100
+++ vdr-1.7.40/shutdown.c	2013-03-10 20:59:56.384164320 +0100
@@ -17,6 +17,7 @@
 #include "channels.h"
 #include "config.h"
 #include "cutter.h"
+#include "filetransfer.h"
 #include "i18n.h"
 #include "interface.h"
 #include "menu.h"
@@ -171,6 +172,10 @@
      if (!Interactive || !Interface->Confirm(tr("Editing - shut down anyway?")))
         return false;
      }
+  if (cFileTransfer::Active()) {
+     if (!Interactive || !Interface->Confirm(tr("Transfering file - shut down anyway?")))
+        return false;
+     }
 
   cTimer *timer = Timers.GetNextActiveTimer();
   time_t Next = timer ? timer->StartTime() : 0;
@@ -214,6 +219,10 @@
      if (!Interactive || !Interface->Confirm(tr("Editing - restart anyway?")))
         return false;
      }
+  if (cFileTransfer::Active()) {
+     if (!Interactive || !Interface->Confirm(tr("Transfering file - restart anyway?")))
+        return false;
+     }
 
   cTimer *timer = Timers.GetNextActiveTimer();
   time_t Next  = timer ? timer->StartTime() : 0;
diff -urN vdr-1.7.40.orig/svdrp.c vdr-1.7.40/svdrp.c
--- vdr-1.7.40.orig/svdrp.c	2013-02-17 14:18:01.000000000 +0100
+++ vdr-1.7.40/svdrp.c	2013-03-10 20:59:56.384164320 +0100
@@ -31,6 +31,7 @@
 #include "cutter.h"
 #include "device.h"
 #include "eitscan.h"
+#include "filetransfer.h"
 #include "keys.h"
 #include "menu.h"
 #include "plugin.h"
@@ -193,6 +194,11 @@
   "    After a CLRE command, no further EPG processing is done for 10\n"
   "    seconds, so that data sent with subsequent PUTE commands doesn't\n"
   "    interfere with data from the broadcasters.",
+  "CPYR <number> <new name>\n"
+  "    Copy the recording with the given number. Before a recording can be\n"
+  "    copied, an LSTR command must have been executed in order to retrieve\n"
+  "    the recording numbers. The numbers don't change during subsequent CPYR\n"
+  "    commands.",
   "DELC <number>\n"
   "    Delete channel.",
   "DELR <number>\n"
@@ -258,6 +264,11 @@
   "    used to easily activate or deactivate a timer.",
   "MOVC <number> <to>\n"
   "    Move a channel to a new position.",
+  "MOVR <number> <new name>\n"
+  "    Move the recording with the given number. Before a recording can be\n"
+  "    moved, an LSTR command must have been executed in order to retrieve\n"
+  "    the recording numbers. The numbers don't change during subsequent MOVR\n"
+  "    commands.",
   "NEWC <settings>\n"
   "    Create a new channel. Settings must be in the same format as returned\n"
   "    by the LSTC command.",
@@ -612,6 +623,32 @@
      }
 }
 
+void cSVDRP::CmdCPYR(const char *Option)
+{
+  if (*Option) {
+     char *tail;
+     int n = strtol(Option, &tail, 10);
+     cRecording *recording = Recordings.Get(n - 1);
+     if (recording && tail && tail != Option) {
+        char *oldName = strdup(recording->Name());
+        tail = skipspace(tail);
+        if (!cFileTransfer::Active()) {
+           if (cFileTransfer::Start(recording, tail, true))
+              Reply(250, "Copying recording \"%s\" to \"%s\"", oldName, tail);
+           else
+              Reply(554, "Can't start file transfer");
+           }
+        else
+           Reply(554, "File transfer already active");
+        free(oldName);
+        }
+     else
+        Reply(550, "Recording \"%d\" not found%s", n, Recordings.Count() ? "" : " (use LSTR before copying)");
+     }
+  else
+     Reply(501, "Invalid Option \"%s\"", Option);
+}
+
 void cSVDRP::CmdDELC(const char *Option)
 {
   if (*Option) {
@@ -1320,6 +1357,32 @@
      Reply(501, "Missing channel number");
 }
 
+void cSVDRP::CmdMOVR(const char *Option)
+{
+  if (*Option) {
+     char *tail;
+     int n = strtol(Option, &tail, 10);
+     cRecording *recording = Recordings.Get(n - 1);
+     if (recording && tail && tail != Option) {
+        char *oldName = strdup(recording->Name());
+        tail = skipspace(tail);
+        if (!cFileTransfer::Active()) {
+           if (cFileTransfer::Start(recording, tail))
+              Reply(250, "Moving recording \"%s\" to \"%s\"", oldName, tail);
+           else
+              Reply(554, "Can't start file transfer");
+           }
+        else
+           Reply(554, "File transfer already active");
+        free(oldName);
+        }
+     else
+        Reply(550, "Recording \"%d\" not found%s", n, Recordings.Count() ? "" : " (use LSTR before moving)");
+     }
+  else
+     Reply(501, "Invalid Option \"%s\"", Option);
+}
+
 void cSVDRP::CmdNEWC(const char *Option)
 {
   if (*Option) {
@@ -1644,6 +1707,7 @@
   s = skipspace(s);
   if      (CMD("CHAN"))  CmdCHAN(s);
   else if (CMD("CLRE"))  CmdCLRE(s);
+  else if (CMD("CPYR"))  CmdCPYR(s);
   else if (CMD("DELC"))  CmdDELC(s);
   else if (CMD("DELR"))  CmdDELR(s);
   else if (CMD("DELT"))  CmdDELT(s);
@@ -1659,6 +1723,7 @@
   else if (CMD("MODC"))  CmdMODC(s);
   else if (CMD("MODT"))  CmdMODT(s);
   else if (CMD("MOVC"))  CmdMOVC(s);
+  else if (CMD("MOVR"))  CmdMOVR(s);
   else if (CMD("NEWC"))  CmdNEWC(s);
   else if (CMD("NEWT"))  CmdNEWT(s);
   else if (CMD("NEXT"))  CmdNEXT(s);
diff -urN vdr-1.7.40.orig/svdrp.h vdr-1.7.40/svdrp.h
--- vdr-1.7.40.orig/svdrp.h	2012-04-26 12:30:06.000000000 +0200
+++ vdr-1.7.40/svdrp.h	2013-03-10 20:59:56.384164320 +0100
@@ -56,6 +56,7 @@
   void PrintHelpTopics(const char **hp);
   void CmdCHAN(const char *Option);
   void CmdCLRE(const char *Option);
+  void CmdCPYR(const char *Option);
   void CmdDELC(const char *Option);
   void CmdDELR(const char *Option);
   void CmdDELT(const char *Option);
@@ -71,6 +72,7 @@
   void CmdMODC(const char *Option);
   void CmdMODT(const char *Option);
   void CmdMOVC(const char *Option);
+  void CmdMOVR(const char *Option);
   void CmdNEWC(const char *Option);
   void CmdNEWT(const char *Option);
   void CmdNEXT(const char *Option);
diff -urN vdr-1.7.40.orig/vdr.c vdr-1.7.40/vdr.c
--- vdr-1.7.40.orig/vdr.c	2013-03-03 11:25:11.000000000 +0100
+++ vdr-1.7.40/vdr.c	2013-03-10 20:59:56.388164319 +0100
@@ -45,6 +45,7 @@
 #include "dvbdevice.h"
 #include "eitscan.h"
 #include "epg.h"
+#include "filetransfer.h"
 #include "i18n.h"
 #include "interface.h"
 #include "keys.h"
@@ -1305,6 +1306,12 @@
               else
                  Skins.Message(mtInfo, tr("Editing process finished"));
               }
+           if (!cFileTransfer::Active() && cFileTransfer::Ended()) {
+              if (cFileTransfer::Error())
+                 Skins.QueueMessage(mtError, tr("File transfer failed!"));
+              else
+                 Skins.QueueMessage(mtInfo, tr("File transfer finished"));
+              }
            }
 
         // SIGHUP shall cause a restart:
@@ -1320,7 +1327,7 @@
               ShutdownHandler.countdown.Cancel();
            }
 
-        if ((Now - LastInteract) > ACTIVITYTIMEOUT && !cRecordControls::Active() && !cCutter::Active() && !Interface->HasSVDRPConnection() && (Now - cRemote::LastActivity()) > ACTIVITYTIMEOUT) {
+        if ((Now - LastInteract) > ACTIVITYTIMEOUT && !cRecordControls::Active() && !cCutter::Active() && !cFileTransfer::Active() && !Interface->HasSVDRPConnection() && (Now - cRemote::LastActivity()) > ACTIVITYTIMEOUT) {
            // Handle housekeeping tasks
 
            // Shutdown:
@@ -1369,6 +1376,7 @@
 
   PluginManager.StopPlugins();
   cRecordControls::Shutdown();
+  cFileTransfer::Stop();
   cCutter::Stop();
   delete Menu;
   cControl::Shutdown();
diff -urN vdr-1.7.40.orig/videodir.c vdr-1.7.40/videodir.c
--- vdr-1.7.40.orig/videodir.c	2012-09-30 14:06:33.000000000 +0200
+++ vdr-1.7.40/videodir.c	2013-03-10 20:59:56.388164319 +0100
@@ -229,6 +229,22 @@
   return NULL;
 }
 
+cString NewVideoFileName(const char *FileName, const char *NewDirName)
+{
+  char *NewDir = ExchangeChars(strdup(NewDirName), true);
+  if (NewDir) {
+     const char *p = FileName + strlen(FileName); // p points at the terminating 0
+     while (p-- > FileName) {
+           if (*p == '/')
+              break;
+           }
+     cString NewName = cString::sprintf("%s/%s%s", VideoDirectory, NewDir, p);
+     free(NewDir);
+     return NewName;
+     }
+  return NULL;
+}
+
 void RemoveEmptyVideoDirectories(const char *IgnoreFiles[])
 {
   cVideoDirectory Dir;
diff -urN vdr-1.7.40.orig/videodir.h vdr-1.7.40/videodir.h
--- vdr-1.7.40.orig/videodir.h	2012-09-30 13:01:15.000000000 +0200
+++ vdr-1.7.40/videodir.h	2013-03-10 20:59:56.388164319 +0100
@@ -23,6 +23,7 @@
 bool VideoFileSpaceAvailable(int SizeMB);
 int VideoDiskSpace(int *FreeMB = NULL, int *UsedMB = NULL); // returns the used disk space in percent
 cString PrefixVideoFileName(const char *FileName, char Prefix);
+cString NewVideoFileName(const char *FileName, const char *NewDirName);
 void RemoveEmptyVideoDirectories(const char *IgnoreFiles[] = NULL);
 bool IsOnVideoDirectoryFileSystem(const char *FileName);
 
