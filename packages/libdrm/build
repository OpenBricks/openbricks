#!/bin/sh

. config/options

drm_add_driver () {
  CFG_DRIVERS="$CFG_DRIVERS --enable-$1" || \
  CFG_DRIVERS="$CFG_DRIVERS --disable-$1"
}

pkg_uses $1 intel   && drm_add_driver intel
pkg_uses $1 radeon  && drm_add_driver radeon
pkg_uses $1 nouveau && drm_add_driver nouveau-experimental-api
pkg_uses $1 vmwgfx  && drm_add_driver vmwgfx-experimental-api

[ "$TARGET_MACHINE" = gta02 ] \
                    && drm_add_driver glamo-experimental-api

cd $BUILD/$1*

do_autoconf

do_configure \
            --enable-silent-rules \
            --enable-libkms \
            $CFG_DRIVERS \
            --enable-udev \
            --enable-largefile \
            --with-kernel-source=$(kernel_path) \

make
make_install
