#!/bin/sh

. config/options

pkg_uses $1 intel && \
  CFG_DRIVERS="$CFG_DRIVERS --enable-intel" || \
  CFG_DRIVERS="$CFG_DRIVERS --disable-intel"
pkg_uses $1 radeon && \
  CFG_DRIVERS="$CFG_DRIVERS --enable-radeon" || \
  CFG_DRIVERS="$CFG_DRIVERS --disable-radeon"
pkg_uses $1 nouveau && \
  CFG_DRIVERS="$CFG_DRIVERS --enable-nouveau-experimental-api" || \
  CFG_DRIVERS="$CFG_DRIVERS --disable-nouveau-experimental-api"
pkg_uses $1 vmwgfx && \
  CFG_DRIVERS="$CFG_DRIVERS --enable-vmwgfx-experimental-api" || \
  CFG_DRIVERS="$CFG_DRIVERS --disable-vmwgfx-experimental-api"

[ "$TARGET_MACHINE" = gta02 ] && \
  CFG_DRIVERS="$CFG_DRIVERS --enable-glamo-experimental-api" || \
  CFG_DRIVERS="$CFG_DRIVERS --disable-glamo-experimental-api"

cd $BUILD/$1*
do_configure \
            --enable-silent-rules \
            --enable-libkms \
            $CFG_DRIVERS \
            --enable-udev \
            --enable-largefile \
            --with-kernel-source=$(kernel_path) \

make
make_install
