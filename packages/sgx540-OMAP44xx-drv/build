#!/bin/sh

. config/options

cd $BUILD/$1*/sgx

make -C eurasiacon/build/linux/omap4430_linux/kbuild \
  KERNELDIR=$(kernel_path) \
  CROSS_COMPILE=${TARGET_PREFIX} \
  SUPPORT_XORG=1 \
  DISABLE_SGX_PB_GROW_SHRINK=1 \

install_dir="$PWD/.install"
debug_dir="$PWD/.install-debuginfo/usr/lib/debug"
kmod_dir="$install_dir/lib/modules/$(kernel_version)"

mkdir -p $kmod_dir/kernel/drivers/gpu/pvr $debug_dir
cp -P eurasiacon/binary_omap4430_linux_release/omap_gpu.ko $kmod_dir/kernel/drivers/gpu/pvr
strip_kmods "$kmod_dir" "$debug_dir"
