#!/bin/sh

. config/options

$SCRIPTS/build linux

cd $BUILD/$1*

make -C eurasiacon/build/linux/omap3430_linux/kbuild \
  KERNELDIR=$(kernel_path) \
  CROSS_COMPILE=${TARGET_PREFIX}

install_dir="$PWD/.install"
debug_dir="$PWD/.install-debuginfo/usr/lib/debug"
kmod_dir="$install_dir/lib/modules/$(kernel_version)"

mkdir -p $kmod_dir/kernel/drivers/gpu/pvr $debug_dir
for m in pvrsrvkm omaplfb bc_example; do
  cp -P eurasiacon/binary_omap3430_linux_release/${m}.ko \
    $kmod_dir/kernel/drivers/gpu/pvr
done

strip_kmods "$kmod_dir" "$debug_dir"
