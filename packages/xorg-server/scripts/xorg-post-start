#!/bin/sh

# wait a bit for Xorg to startup
sleep 1

# special hack for vmware to enhance screen resolution
grep -q 'VMWARE(0)' /var/log/Xorg.0.log && VMWARE=yes

if [ "$XORG_RESX" = auto -a "$XORG_RESY" = auto -a "$VMWARE" = yes ]; then
  XORG_RESX=1280
  XORG_RESY=720
fi

[ "$XORG_RESX" != auto -a "$XORG_RESY" != auto ] && XRANDR_ARGS="-s ${XORG_RESX}x${XORG_RESY}"
[ "$XORG_RATE" != auto ] && XRANDR_ARGS="$XRANDR_ARGS -r $XORG_RATE"

[ -n "$XRANDR_ARGS" ] && xrandr -d $DISPLAY $XRANDR_ARGS >> /var/log/xrandr.log 2>&1

# set Xorg keymap
MAP="us"
grep qwerty /proc/cmdline && MAP="us"
grep qwertz /proc/cmdline && MAP="de"
grep azerty /proc/cmdline && MAP="fr"
setxkbmap -display $DISPLAY $MAP

exit 0
