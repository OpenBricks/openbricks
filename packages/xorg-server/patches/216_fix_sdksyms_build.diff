commit f6e8ac4ed1fc7687c7d312fc6a10499afbac2b31
Author: Keith Packard <keithp@keithp.com>
Date:   Sat Feb 26 10:31:50 2011 -0800

    loader: Don't distribute sdksyms.c and make it depend on the config
    
    sdksyms.c is constructed by processing header files with the C
    preprocessor. Its contents will vary depending on the precise
    configuration options, and so must depend on the config header
    files.
    
    We have one header file which is always changed when any config option
    is modified called do-not-use-config.h (which may want a different
    name at some point), so make sdksyms.c depend on that file.
    
    Also, we don't want to ship this file; it always needs to be
    built. So, include it in the nodist_libloader_la_SOURCES list to
    prevent it from being added to the tarball.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>
    Reviewed-by: Dan Nicholson <dbn.lists@gmail.com>
    (cherry picked from commit 628d16a92a7fa556fbb70bf4a4adf57ec05c190b)

diff --git a/hw/xfree86/loader/Makefile.am b/hw/xfree86/loader/Makefile.am
index 7f386cc..0e5b304 100644
--- a/hw/xfree86/loader/Makefile.am
+++ b/hw/xfree86/loader/Makefile.am
@@ -12,18 +12,21 @@ EXTRA_DIST = \
 	loaderProcs.h \
 	sdksyms.sh
 
+nodist_libloader_la_SOURCES = \
+	sdksyms.c
+
 libloader_la_SOURCES = \
 	loader.c \
 	loaderProcs.h \
 	loadext.c \
         loadmod.c \
-	os.c \
-	sdksyms.c
+	os.c
+
 libloader_la_LIBADD = $(DLOPEN_LIBS)
 
 CLEANFILES = sdksyms.c sdksyms.dep
 
-sdksyms.dep sdksyms.c: sdksyms.sh
+sdksyms.dep sdksyms.c: sdksyms.sh $(top_builddir)/include/do-not-use-config.h
 	CPP='$(CPP)' AWK='$(AWK)' $(srcdir)/sdksyms.sh $(top_srcdir) $(AM_CFLAGS) $(CFLAGS) $(INCLUDES)
 
 SDKSYMS_DEP = sdksyms.dep
diff -Naur a/hw/xfree86/loader/Makefile.in b/hw/xfree86/loader/Makefile.in
--- a/hw/xfree86/loader/Makefile.in	2011-04-03 11:57:16.769758230 +0200
+++ b/hw/xfree86/loader/Makefile.in	2011-04-03 11:58:24.241760275 +0200
@@ -425,13 +425,15 @@
 	loaderProcs.h \
 	sdksyms.sh
 
+nodist_libloader_la_SOURCES = \
+	sdksyms.c
+
 libloader_la_SOURCES = \
 	loader.c \
 	loaderProcs.h \
 	loadext.c \
         loadmod.c \
-	os.c \
-	sdksyms.c
+	os.c
 
 libloader_la_LIBADD = $(DLOPEN_LIBS)
 CLEANFILES = sdksyms.c sdksyms.dep
@@ -723,7 +725,7 @@
 	pdf pdf-am ps ps-am tags uninstall uninstall-am
 
 
-sdksyms.dep sdksyms.c: sdksyms.sh
+sdksyms.dep sdksyms.c: sdksyms.sh $(top_builddir)/include/do-not-use-config.h
 	CPP='$(CPP)' AWK='$(AWK)' $(srcdir)/sdksyms.sh $(top_srcdir) $(AM_CFLAGS) $(CFLAGS) $(INCLUDES)
 include $(SDKSYMS_DEP)
 
