#!/bin/sh

. config/options

mkdir -p $INSTALL/boot/netboot

YCONF=$INSTALL/boot/yaboot.conf
NYCONF=$INSTALL/boot/netboot/yaboot.conf

cp $BUILD/$1*/second/yaboot $INSTALL/boot
cp $PACKAGES/$1/config/yaboot.conf $YCONF

[ "$TARGET_ARCH" = powerpc64 ] && sed -i "s/vmlinux/zImage/g" $YCONF

sed -i "s%remote=default_remote%remote=$REMOTE%" $YCONF
sed -i "s%receiver=default_receiver%receiver=$RECEIVER%" $YCONF
sed -i "s%keymap=qwerty%keymap=$KEYMAP%" $YCONF
sed -i "s%lang=en%lang=$MENU_LANG%" $YCONF
cp $PACKAGES/$1/config/ofboot.b $INSTALL/boot
sed s%release-nr%$DISTRO_VERSION% $PACKAGES/$1/config/boot.msg > $INSTALL/boot/boot.msg

sed 's/^device=.*/device=enet:/' $YCONF > $NYCONF
sed -i 's%/GEEXBOX/boot/%GEEXBOX.powerpc/boot/%g' $NYCONF
sed -i 's/boot=[^ \"]*/boot=nfs/' $NYCONF
sed -i "s%\(.*append.*\)\"$%\1 nfsroot=$DEFAULT_NFS_SERVER:$DEFAULT_NFS_DIR.$VERSION_SUFFIX\"%" $NYCONF
