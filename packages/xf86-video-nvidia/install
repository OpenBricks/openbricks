#!/bin/sh

. config/options

require_glibc $1

XORG_DST="$INSTALL/$XORG_PATH_MODULES"

get_meta linux
KVER=$PKG_VERSION

# nVidia kernel driver
mkdir -p $INSTALL/lib/modules/$KVER/kernel/drivers/video
cp $BUILD/$1/usr/src/nv/nvidia.ko \
  $INSTALL/lib/modules/$KVER/kernel/drivers/video

# X.Org driver
mkdir -p $XORG_DST/drivers
cp $BUILD/$1/usr/X11R6/lib/modules/drivers/*_drv.so $XORG_DST/drivers

# System Libs
cp $BUILD/$1/usr/lib/tls/*tls*.so* $INSTALL/usr/lib/libnvidia-tls.so.1

# OpenGL libs
cp $BUILD/$1/usr/lib/libGLcore.so* $INSTALL/usr/lib/libGLcore.so.1
mkdir -p $INSTALL/usr/lib/nvidia
cp $BUILD/$1/usr/lib/libGL.so* $INSTALL/usr/lib/nvidia/libGL.so.1
cp $BUILD/$1/usr/X11R6/lib/modules/extensions/libglx.so* \
    $INSTALL/usr/lib/nvidia/libglx.so

# VDPAU libs
if [ "$VDPAU" = yes ]; then
  cp $BUILD/$1/usr/lib/vdpau/libvdpau_nvidia.so* \
      $INSTALL/usr/lib/libvdpau_nvidia.so.1
  ln -s libvdpau_nvidia.so.1 $INSTALL/usr/lib/libvdpau_nvidia.so
fi

exit 0
