#!/bin/sh

. config/options

$SCRIPTS/build toolchain

get_meta $1
BUSYBOX=`ls -d $BUILD/$1-$PKG_VERSION`

if [ -f config/flavours/$FLAVOUR/busybox.conf ]; then
  BUSYBOX_CONFIG="config/flavours/$FLAVOUR/busybox.conf"
else
  BUSYBOX_CONFIG="$PACKAGES/$1/config/$1.conf"
fi

cp $BUSYBOX_CONFIG $BUSYBOX/.config

[ -n "$TIMEZONE" ] && sed -i -e 's/^# CONFIG_HWCLOCK .*$/CONFIG_HWCLOCK=yes/g' -e 's/^# CONFIG_FEATURE_HWCLOCK_LONG_OPTIONS .*/CONFIG_FEATURE_HWCLOCK_LONG_OPTIONS=yes/g' $BUSYBOX/.config

[ $TARGET_ARCH != i386 -a $TARGET_ARCH != x86_64 ] && \
  sed -i "s%^CONFIG_ACPID.*%# CONFIG_ACPID is not set%" $BUSYBOX/.config

if [ "$DEVTOOLS" = "yes" ]; then
  for option in CONFIG_DIFF CONFIG_FEATURE_DIFF_LONG_OPTIONS CONFIG_FEATURE_DIFF_DIR CONFIG_DEVMEM CONFIG_NC_SERVER CONFIG_FEATURE_NETSTAT_WIDE CONFIG_FEATURE_NETSTAT_PRG CONFIG_DD CONFIG_FEATURE_DD_SIGNAL_HANDLING; do
    sed -i -e "s/^# ${option} .*\$/${option}=y/g" $BUSYBOX/.config
  done
fi

# make -C $BUSYBOX oldconfig HOSTCC=$HOST_CC
