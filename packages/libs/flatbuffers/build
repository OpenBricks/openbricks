#!/bin/sh

. config/options

get_meta $1
cd $PKG_BUILD_DIR

setup_toolchain host
rm -rf .build-host
mkdir -p .build-host

cd .build-host
cmake \
    -DFLATBUFFERS_INSTALL=OFF \
    -DFLATBUFFERS_BUILD_TESTS=OFF \
    -DFLATBUFFERS_BUILD_FLATC=ON \
    -DFLATBUFFERS_BUILD_FLATHASH=ON \
    -DFLATBUFFERS_BUILD_FLATLIB=OFF \
    -DFLATBUFFERS_STATIC_FLATC=ON \
    ..
make
cd ..

setup_toolchain target

do_cmake_build \
    -DFLATBUFFERS_BUILD_TESTS=OFF \
    -DFLATBUFFERS_BUILD_FLATC=OFF \
    -DFLATBUFFERS_BUILD_FLATHASH=OFF \
    -DFLATBUFFERS_BUILD_FLATLIB=ON \
    ..

mkdir -p .install/bin
cp .build-host/flat* .install/bin/
