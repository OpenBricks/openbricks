#!/bin/sh

. config/options

mkdir -p $INSTALL/etc
cp $PACKAGES/$1/config/network $INSTALL/etc
cp $PACKAGES/$1/config/nfs $INSTALL/etc
cp $PACKAGES/$1/config/9p $INSTALL/etc
cp $PACKAGES/$1/config/netstream $INSTALL/etc
cp $PACKAGES/$1/scripts/network.scripts $INSTALL/etc
cp $CONFIG/issue $INSTALL/etc
sed -i s%target-arch%$TARGET_ARCH% $INSTALL/etc/issue
sed -i s%release-nr%$GEEXBOX_VERSION% $INSTALL/etc/issue

mkdir -p $INSTALL/usr/bin
cp $PACKAGES/$1/scripts/automount_9p $INSTALL/usr/bin
cp $PACKAGES/$1/scripts/automount_nfs $INSTALL/usr/bin

$SCRIPTS/install bftpd
[ "$SAMBA" = yes -o "$SAMBA_SERVER" = yes ] && $SCRIPTS/install samba
$SCRIPTS/install wget

[ "$UPNP" = yes ] && $SCRIPTS/install djmount

if [ "$WIFI" = yes ]; then
  MADWIFI=madwifi-trunk
  [ "$TARGET_PLATFORM" = eeepc ] && MADWIFI=eeepc-madwifi-nr
  $SCRIPTS/install wireless_tools
  $SCRIPTS/install acx
  $SCRIPTS/install $MADWIFI
  [ "$NDISWRAPPER" = yes ] && $SCRIPTS/install ndiswrapper
  [ "$WPA_SUPPLICANT" = yes ] && $SCRIPTS/install wpa_supplicant
  [ "$OLSR" = yes ] && $SCRIPTS/install olsrd
fi

NET=$INSTALL/etc/network
sed -i "s/^TELNET_SERVER=.*/TELNET_SERVER=\"$SERVICES\"/" $NET
sed -i "s/^FTP_SERVER=.*/FTP_SERVER=\"$SERVICES\"/" $NET
sed -i "s/^HTTP_SERVER=.*/HTTP_SERVER=\"$SERVICES\"/" $NET
sed -i "s/^SAMBA_SERVER=.*/SAMBA_SERVER=\"$SAMBA_SERVER\"/" $NET
