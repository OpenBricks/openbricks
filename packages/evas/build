#!/bin/sh

. config/options

if [ "$XORG" = yes ]; then
  WITH_X="--with-x --enable-software-xlib --enable-software-16-x11 --enable-xrender-x11 --enable-gl-x11"
  EXTRA_LIBS="-lstdc++"
fi

if [ "$SDL" = yes ]; then
  CFG_SDL="--enable-sdl-primitive --enable-software-sdl --disable-gl-sdl"
else
  CFG_SDL="--disable-sdl-primitive --disable-software-sdl --disable-gl-sdl"
fi

if [ "$DIRECTFB" = yes ]; then
  CFG_DFB="--enable-directfb"
else
  CFG_DFB="--disable-directfb"
fi

CFG_NEON="--disable-cpu-neon"
if [ $TARGET_ARCH = arm ]; then
  [ "$NEON" = yes ] && CFG_NEON="--enable-cpu-neon"
  OPENGL_ES="--enable-gl-flavor-gles --enable-gles-variety-sgx"
fi

[ "$TARGET_LIBC" = "uClibc" ] && EXTRA_LIBS="-liconv $EXTRA_LIBS"

cd $BUILD/$1*
export LIBS="$EXTRA_LIBS"
do_configure \
            --enable-pthreads \
            --enable-pipe-render \
            --enable-async-preload \
            --enable-async-events \
            --enable-async-render \
            --disable-doc \
            --enable-image-loader-eet \
            --enable-image-loader-gif \
            --enable-image-loader-jpeg \
            --enable-image-loader-png \
            --enable-image-loader-tiff \
            --enable-image-loader-pmaps \
            --enable-image-loader-xpm \
            --enable-image-loader-bmp \
            --enable-image-loader-tga \
            --enable-font-loader-eet \
            --disable-software-xcb \
            --disable-xrender-xcb \
            --enable-fb \
            $CFG_NEON \
            $CFG_DFB \
            $CFG_SDL \
            $OPENGL_ES \
            $WITH_X \

make
make_install
