#!/bin/sh

. config/options

get_meta $1

mkdir -p $PKG_BUILD_DIR
$SCRIPTS/extract $1 "*" $PKG_BUILD_DIR

# Rename firmwares that need to be
mv $PKG_BUILD_DIR/p54pci_1.0.4.3.arm.bz2 $PKG_BUILD_DIR/isl3890.bz2
mv $PKG_BUILD_DIR/p54u_2.5.6.0.arm.bz2 $PKG_BUILD_DIR/isl3890usb.bz2
mv $PKG_BUILD_DIR/p54pci_1.1.0.0.arm.bz2 $PKG_BUILD_DIR/isl3877.bz2
mv $PKG_BUILD_DIR/p54u_3887_2.5.8.0.arm.bz2 $PKG_BUILD_DIR/isl3887usb_bare.bz2

# Move firmwares to their belonging path
mkdir -p $PKG_BUILD_DIR/acx/default
mv $PKG_BUILD_DIR/tiacx* $PKG_BUILD_DIR/acx/default/
mkdir -p $PKG_BUILD_DIR/radeon && \
  mv $PKG_BUILD_DIR/R[0-9][0-9][0-9]_rlc.bin* $PKG_BUILD_DIR/radeon/
mkdir -p $PKG_BUILD_DIR/ti-connectivity && \
  mv $PKG_BUILD_DIR/wl1271-*.bin* $PKG_BUILD_DIR/ti-connectivity/

# Extract firmware archives that need to be
[ -f $PKG_BUILD_DIR/b43.tar ] && tar xvf $PKG_BUILD_DIR/b43.tar
[ -f $PKG_BUILD_DIR/b43legacy.tar ] && tar xvf $PKG_BUILD_DIR/b43legacy.tar

# Uncompress firmwares
bunzip2 -f $PKG_BUILD_DIR/*.bz2
bunzip2 -f $PKG_BUILD_DIR/radeon/*.bz2
bunzip2 -f $PKG_BUILD_DIR/b43/*.bz2
bunzip2 -f $PKG_BUILD_DIR/b43legacy/*.bz2
bunzip2 -f $PKG_BUILD_DIR/ti-connectivity/*.bz2
